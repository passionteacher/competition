<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>음성 스크롤</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Inter 폰트 임포트 */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        
        html, body {
            height: 100vh; /* Ensure html and body take full viewport height */
            overflow: hidden; /* Prevent scrolling on the body itself */
        }
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background-color: #f0f2f5; /* 부드러운 배경색 */
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center; /* 앱 컨테이너를 수직 중앙 정렬 */
        }
        .app-container {
            width: 100%;
            max-width: 420px; /* 모바일 앱 최대 너비 */
            height: 100vh; /* Set to 100vh to ensure it fills the viewport height */
            background-color: #ffffff; /* 앱 내부 흰색 배경 */
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1); /* 더 깊고 부드러운 그림자 */
            border-radius: 1.5rem; /* 더 둥근 모서리 */
            display: flex;
            flex-direction: column;
            overflow: hidden; /* 스크롤바가 컨테이너 밖으로 나가지 않도록 */
            position: relative; /* 상태 바 고정을 위해 */
        }
        .header {
            background-color: #ffffff;
            padding: 1rem 1.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid #f0f0f0;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .video-feed {
            flex-grow: 1; /* 남은 공간을 채우도록 설정 */
            overflow-y: auto; /* 비디오 피드만 스크롤 가능하게 */
            -webkit-overflow-scrolling: touch; /* iOS 부드러운 스크롤 */
            padding: 1rem;
            padding-bottom: 6rem; /* 음성 인식 상태 메시지 영역만큼 패딩 확보 */
            min-height: 300px; /* 최소 높이를 추가하여 스크롤 가능성을 확보 */
        }
        /* 스크롤바 숨기기 (선택 사항) */
        .video-feed::-webkit-scrollbar {
            display: none;
        }
        .video-feed {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }

        .video-card {
            background-color: #ffffff;
            border-radius: 0.75rem; /* 카드 모서리 둥글게 */
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06); /* 카드 그림자 */
            margin-bottom: 1.5rem; /* 카드 간 간격 */
            overflow: hidden;
            transition: transform 0.2s ease-in-out; /* 호버 효과 */
        }
        .video-card:hover {
            transform: translateY(-3px);
        }
        .video-card img {
            width: 100%;
            height: 200px; /* 썸네일 고정 높이 */
            object-fit: cover; /* 이미지 비율 유지하며 채움 */
        }
        .video-card .p-4 {
            padding: 1rem;
        }
        .video-card h2 {
            font-size: 1.125rem; /* 텍스트 크기 */
            font-weight: 600; /* 세미볼드 */
            color: #1a202c; /* 진한 회색 */
            margin-bottom: 0.25rem;
        }
        .video-card p {
            font-size: 0.875rem; /* 작은 텍스트 */
            color: #6b7280; /* 중간 회색 */
        }

        /* 음성 인식 상태 바 스타일 */
        .speech-status-bar {
            background-color: #4a5568; /* 기본 회색 (slate-700과 유사) */
            color: #ffffff;
            padding: 1rem 1.5rem;
            text-align: center;
            font-size: 0.9rem;
            border-top-left-radius: 1rem; /* 상단 모서리 둥글게 */
            border-top-right-radius: 1rem; /* 상단 모서리 둥글게 */
            position: absolute; /* 앱 컨테이너 내부에 고정 */
            bottom: 0;
            left: 0;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 -4px 15px rgba(0, 0, 0, 0.1); /* 상단 그림자 */
            transition: background-color 0.3s ease-in-out, transform 0.3s ease-in-out;
            transform: translateY(0); /* 기본 위치 */
        }

        /* 마이크 아이콘 깜빡임 애니메이션 */
        @keyframes pulse-mic {
            0%, 100% { opacity: 0.7; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.1); }
        }
        .mic-pulsing {
            animation: pulse-mic 1.5s infinite ease-in-out;
        }

        /* 명령 대기 중 상태 바 색상 */
        .speech-status-bar.listening-for-command {
            background-color: #10B981; /* 에메랄드 그린 (emerald-500) */
            transform: translateY(-5px); /* 살짝 위로 올라오는 효과 */
        }
        /* 명령 인식 완료/실행 상태 바 색상 */
        .speech-status-bar.command-executed {
            background-color: #2563eb; /* 파란색 (blue-600) */
        }
        /* 오류 상태 바 색상 */
        .speech-status-bar.error-state {
            background-color: #dc2626; /* 빨간색 (red-600) */
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="app-container">
        <!-- 상단 헤더 바 -->
        <header class="header">
            <div class="flex items-center">
                <img src="https://placehold.co/32x32/FF0000/FFFFFF?text=YT" alt="YouTube Logo" class="mr-2 rounded-md">
                <h1 class="text-xl font-bold text-gray-800">YouTube</h1>
            </div>
            <div class="flex items-center space-x-4">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" />
                </svg>
                <img alt="Profile Picture" class="rounded-full w-8 h-8 object-cover" src="https://placehold.co/32x32/007BFF/FFFFFF?text=P">
            </div>
        </header>

        <!-- 비디오 피드 (스크롤 가능한 영역) -->
        <main class="video-feed">
            <!-- 비디오 카드 예시 (반복) -->
            <div class="video-card">
                <img alt="Video Thumbnail" src="https://placehold.co/600x337/E0E0E0/333333?text=Video+Thumbnail+1">
                <div class="p-4">
                    <h2>놀라운 자연 다큐멘터리: 숨겨진 세계의 발견</h2>
                    <p>내셔널 지오그래픽 • 조회수 120만회 • 2일 전</p>
                </div>
            </div>

            <div class="video-card">
                <img alt="Video Thumbnail" src="https://placehold.co/600x337/D0D0D0/333333?text=Video+Thumbnail+2">
                <div class="p-4">
                    <h2>최신 기술 트렌드 2024: 미래를 바꾸는 혁신</h2>
                    <p>테크 인사이트 • 조회수 85만회 • 1주 전</p>
                </div>
            </div>

            <div class="video-card">
                <img alt="Video Thumbnail" src="https://placehold.co/600x337/C0C0C0/333333?text=Video+Thumbnail+3">
                <div class="p-4">
                    <h2>초보자를 위한 요리 강좌: 10분 만에 만드는 파스타</h2>
                    <p>맛있는 레시피 • 조회수 50만회 • 3일 전</p>
                </div>
            </div>

            <div class="video-card">
                <img alt="Video Thumbnail" src="https://placehold.co/600x337/B0B0B0/333333?text=Video+Thumbnail+4">
                <div class="p-4">
                    <h2>세계 여행 브이로그: 유럽의 숨겨진 보석들</h2>
                    <p>여행자 김씨 • 조회수 200만회 • 2주 전</p>
                </div>
            </div>

            <div class="video-card">
                <img alt="Video Thumbnail" src="https://placehold.co/600x337/A0A0A0/333333?text=Video+Thumbnail+5">
                <div class="p-4">
                    <h2>집에서 할 수 있는 간단한 운동 루틴</h2>
                    <p>건강한 라이프 • 조회수 70만회 • 4일 전</p>
                </div>
            </div>

            <div class="video-card">
                <img alt="Video Thumbnail" src="https://placehold.co/600x337/909090/333333?text=Video+Thumbnail+6">
                <div class="p-4">
                    <h2>클래식 음악 명곡 모음: 집중력을 높이는 선율</h2>
                    <p>뮤직 힐링 • 조회수 150만회 • 1달 전</p>
                </div>
            </div>
            <!-- 추가 비디오 카드 시작 -->
            <div class="video-card">
                <img alt="Video Thumbnail" src="https://placehold.co/600x337/808080/333333?text=Video+Thumbnail+7">
                <div class="p-4">
                    <h2>환상적인 우주 탐험: 미지의 행성들</h2>
                    <p>우주 다큐 • 조회수 220만회 • 3일 전</p>
                </div>
            </div>
            <div class="video-card">
                <img alt="Video Thumbnail" src="https://placehold.co/600x337/707070/333333?text=Video+Thumbnail+8">
                <div class="p-4">
                    <h2>역사 속 위대한 순간들: 인류의 발자취</h2>
                    <p>역사 채널 • 조회수 180만회 • 1주 전</p>
                </div>
            </div>
            <div class="video-card">
                <img alt="Video Thumbnail" src="https://placehold.co/600x337/606060/333333?text=Video+Thumbnail+9">
                <div class="p-4">
                    <h2>최고의 게임 플레이: 전설적인 순간들</h2>
                    <p>게임 채널 • 조회수 300만회 • 5일 전</p>
                </div>
            </div>
            <div class="video-card">
                <img alt="Video Thumbnail" src="https://placehold.co/600x337/505050/333333?text=Video+Thumbnail+10">
                <div class="p-4">
                    <h2>인공지능의 미래: 우리의 삶을 어떻게 바꿀까?</h2>
                    <p>미래 기술 • 조회수 90만회 • 2일 전</p>
                </div>
            </div>
            <!-- 추가 비디오 카드 끝 -->
        </main>

        <!-- 음성 인식 상태 메시지 바 -->
        <div id="speechStatusBar" class="speech-status-bar">
            <!-- 마이크 아이콘 -->
            <svg id="micIcon" class="h-6 w-6 mr-2 text-white opacity-60 transition-opacity duration-300" fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 1a3 3 0 00-3 3v6a3 3 0 006 0V4a3 3 0 00-3-3zM3 10a9 9 0 0018 0h-2a7 7 0 01-14 0H3zm9 13c-2.76 0-5-2.24-5-5h2c0 1.65 1.35 3 3 3s3-1.35 3-3h2c0 2.76-2.24 5-5 5z"/>
            </svg>
            <span id="speechStatus">음성 인식 시작 중...</span>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const videoFeed = document.querySelector('.video-feed');
            const speechStatus = document.getElementById('speechStatus');
            const micIcon = document.getElementById('micIcon');
            const speechStatusBar = document.getElementById('speechStatusBar');

            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            let audioContext = null;

            let recognition = null;
            let wakeWordDetected = false;
            let commandTimeout = null;
            let isRecognitionActive = false;

            const WAKE_WORD = '하이 빅스비';
            // 스크롤 업 명령을 '위로 올려줘'와 유사한 발음들로 설정
            const SCROLL_UP_COMMANDS = [
                '위로 올려줘', '위로 올려', '올려줘', '올려',
                '스크롤 위로', '스크롤 올려', '스크롤업', '스끄롤 업', '쓰끄롤 업',
                '위로 올려 주세요', '위로 올려주세요'
            ];
            // 스크롤 다운 명령을 '아래로 내려줘'와 유사한 발음들로 설정
            const SCROLL_DOWN_COMMANDS = [
                '아래로 내려줘', '아래로 내려', '내려줘', '내려',
                '스크롤 아래로', '스크롤 내려', '스크롤다운', '스끄롤 다운', '스끄롤 따운', '쓰끄롤 따운',
                '아래로 내려 주세요', '아래로 내려주세요'
            ];
            const COMMAND_TIMEOUT_MS = 5000; // 5초 동안 명령 대기

            // 웨이크 워드 감지 및 명령 실행 시 재생할 소리 함수
            function playSound() {
                if (!AudioContext) {
                    console.warn("[DEBUG] Web Audio API를 지원하지 않습니다. 삐 소리 재생 불가.");
                    return;
                }
                if (!audioContext) {
                    audioContext = new AudioContext();
                    console.log("[DEBUG] AudioContext initialized.");
                }

                if (audioContext.state === 'suspended') {
                    console.log("[DEBUG] AudioContext is suspended. Attempting to resume...");
                    audioContext.resume().then(() => {
                        console.log("[DEBUG] AudioContext resumed successfully.");
                        _createAndPlayOscillator();
                    }).catch(e => {
                        console.error("[DEBUG] AudioContext resume failed:", e);
                    });
                } else {
                    console.log("[DEBUG] AudioContext is running. Playing sound directly.");
                    _createAndPlayOscillator();
                }

                function _createAndPlayOscillator() {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();

                    oscillator.type = 'sine';
                    oscillator.frequency.setValueAtTime(440, audioContext.currentTime);
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);

                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);

                    oscillator.start(audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.1);
                    oscillator.stop(audioContext.currentTime + 0.1);
                    console.log("[DEBUG] Sound played successfully.");
                }
            }

            // 음성 인식 상태를 초기화하고 웨이크 워드 대기 상태로 되돌리는 함수
            function resetWakeWordState() {
                wakeWordDetected = false;
                clearTimeout(commandTimeout);
                speechStatus.textContent = `음성 명령을 기다리는 중입니다. "${WAKE_WORD}"라고 또렷하게 말해주세요.`;
                micIcon.classList.remove('mic-pulsing');
                micIcon.style.opacity = '0.6';
                speechStatusBar.classList.remove('listening-for-command', 'command-executed', 'error-state');
                console.log("[DEBUG] 상태 리셋: 웨이크 워드 대기 중.");
            }

            // 음성 인식을 안전하게 시작하는 함수
            function startRecognition() {
                if (!SpeechRecognition) {
                    speechStatus.textContent = '죄송합니다. 이 브라우저는 음성 인식을 지원하지 않습니다.';
                    console.warn('Web Speech API (SpeechRecognition) is not supported in this browser.');
                    return;
                }

                if (!recognition) {
                    recognition = new SpeechRecognition();
                    recognition.continuous = true;
                    recognition.interimResults = false;
                    recognition.lang = 'ko-KR'; 
                    recognition.maxAlternatives = 10;

                    recognition.onstart = () => {
                        isRecognitionActive = true;
                        micIcon.classList.add('mic-pulsing');
                        micIcon.style.opacity = '1';
                        console.log("[DEBUG] 음성 인식 시작됨. isRecognitionActive: " + isRecognitionActive);
                        resetWakeWordState();
                    };

                    recognition.onresult = (event) => {
                        let transcript = '';
                        for (let i = event.resultIndex; i < event.results.length; ++i) {
                            if (event.results[i].isFinal) {
                                transcript += event.results[i][0].transcript;
                            }
                        }
                        const command = transcript.trim();
                        console.log("[DEBUG] 인식된 최종 음성:", command);

                        const normalizedCommand = command.toLowerCase().replace(/\s/g, '');

                        if (!wakeWordDetected) {
                            const wakeWordNormalized = WAKE_WORD.toLowerCase().replace(/\s/g, '');
                            if (normalizedCommand.includes(wakeWordNormalized)) {
                                wakeWordDetected = true;
                                playSound();
                                speechStatus.textContent = `"${WAKE_WORD}" 감지됨! 이제 "위로 올려줘" 또는 "아래로 내려줘"라고 말해주세요. (명령 대기 중)`;
                                speechStatusBar.classList.add('listening-for-command');
                                console.log("[DEBUG] 웨이크 워드 감지됨. wakeWordDetected: " + wakeWordDetected);
                                clearTimeout(commandTimeout);
                                commandTimeout = setTimeout(() => {
                                    speechStatus.textContent = "명령 대기 시간이 초과되었습니다. 다시 '하이 빅스비'라고 말해주세요.";
                                    resetWakeWordState();
                                    console.log("[DEBUG] 명령 타임아웃 발생. 상태 리셋.");
                                }, COMMAND_TIMEOUT_MS);
                            }
                        } else {
                            clearTimeout(commandTimeout);

                            const visibleHeight = videoFeed.clientHeight;
                            const scrollAmount = visibleHeight / 2;

                            let commandExecuted = false;

                            const isScrollUpCommand = SCROLL_UP_COMMANDS.some(cmd => 
                                normalizedCommand.includes(cmd.toLowerCase().replace(/\s/g, ''))
                            );

                            if (isScrollUpCommand) {
                                console.log(`[DEBUG] '위로 올려줘' 명령 실행.`);
                                videoFeed.scrollBy({
                                    top: -scrollAmount,
                                    behavior: 'smooth'
                                });
                                playSound();
                                speechStatus.textContent = '위로 반만 스크롤했습니다!';
                                speechStatusBar.classList.add('command-executed');
                                commandExecuted = true;
                            }

                            if (!commandExecuted) {
                                const isScrollDownCommand = SCROLL_DOWN_COMMANDS.some(cmd => 
                                    normalizedCommand.includes(cmd.toLowerCase().replace(/\s/g, ''))
                                );

                                if (isScrollDownCommand) {
                                    console.log(`[DEBUG] '아래로 내려줘' 명령 실행.`);
                                    videoFeed.scrollBy({
                                        top: scrollAmount,
                                        behavior: 'smooth'
                                    });
                                    playSound();
                                    speechStatus.textContent = '아래로 반만 스크롤했습니다!';
                                    speechStatusBar.classList.add('command-executed');
                                    commandExecuted = true;
                                }
                            }
                            
                            if (commandExecuted) {
                                setTimeout(() => resetWakeWordState(), 1500);
                            } else {
                                console.log("[DEBUG] 알 수 없는 명령 (웨이크 워드 후). 명령:", command);
                                speechStatus.textContent = `알 수 없는 명령: "${command}". 다시 "위로 올려줘" 또는 "아래로 내려줘"라고 말해주세요.`;
                                speechStatusBar.classList.add('error-state');
                                setTimeout(() => resetWakeWordState(), 250
